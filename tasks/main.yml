---
- name: Install acme-client
  pkgng: name=acme-client state=present

- name: Make sure the challence directory is present
  file:
    name: /usr/local/www/.well-known-acme-challenge
    state: directory
    mode: 0750
    owner: root
    group: www

- name: Copy the nginx include file to the server
  copy: src=acme.conf dest=/usr/local/etc/nginx/acme.conf

- name: Copy the deploy script
  copy:
    content: "{{ acme_client_deploy_script }}"
    dest: /usr/local/etc/acme/deploy.sh
    mode: 0755

- include: initial.yml config={{ item }}
  with_items: "{{ acme_client_domains }}"
